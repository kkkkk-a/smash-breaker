<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã‚¹ãƒãƒƒã‚·ãƒ¥ãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼</title>
    <link rel="icon" href="icon.png" type="image/png">
    <!-- PeerJS -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç”¨è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« (æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆèª¿æ•´) */
        body { font-family: 'Orbitron', 'Noto Sans JP', sans-serif; }
        .btn, .sys-msg, .net-status { font-family: 'Noto Sans JP', sans-serif; font-weight: bold; }
        
        #screen-network { background: rgba(10, 20, 30, 0.95); z-index: 30; }
        .id-box { 
            background: #000; border: 1px dashed var(--primary-x); padding: 15px; 
            margin: 10px 0; user-select: text; font-family: 'Orbitron', monospace; font-size: 1.2rem; word-break: break-all;
            color: var(--primary-x);
        }
        .net-status { color: var(--accent-gold); font-size: 0.9rem; margin-top: 5px; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        input.room-input {
            background: #222; border: 1px solid #555; color: #fff; padding: 10px;
            font-size: 1.2rem; width: 250px; text-align: center; margin-bottom: 10px;
            font-family: 'Orbitron', sans-serif;
        }
        /* å†æˆ¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
        #rematch-msg {
            color: var(--accent-gold); font-size: 0.9rem; margin-bottom: 10px; height: 1.5em;
            font-family: 'Noto Sans JP', sans-serif;
        }
        /* æ—¥æœ¬èªåŒ–ã«ä¼´ã†æ–‡å­—ã‚µã‚¤ã‚ºèª¿æ•´ */
        .game-title span { font-size: 0.9em; }
    </style>
</head>
<body>
    <div class="bg-grid"></div>

    <div class="app-container">
        <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
        <div id="screen-mode" class="screen active panel-glass">
            <h1 class="game-title">ã‚¹ãƒãƒƒã‚·ãƒ¥ãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼</h1>
            <div class="menu-grid">
                <button class="btn" onclick="GameApp.start('normal')">ãƒ–ãƒ­ãƒƒã‚¯å´©ã—</button>
                <button class="btn" onclick="GameApp.start('endless')">ã‚¨ãƒ³ãƒ‰ãƒ¬ã‚¹ãƒ–ãƒ­ãƒƒã‚¯å´©ã—</button>
                <div class="spacer"></div>
                <button class="btn btn-vs" onclick="GameApp.start('local-vs')">ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ (2P)</button>
                <button class="btn btn-net" onclick="Network.openMenu()">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦</button>
                <div class="spacer"></div>
                <button class="btn btn-gold" onclick="GameApp.openEditor()">ãƒ‘ãƒ‰ãƒ«å·¥æˆ¿ (ä½œæˆ)</button>
                <button class="btn btn-sub" onclick="GameApp.openSettings()">ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠ</button>
            </div>
            <div class="controls-info">
                [P1] çŸ¢å° / WASD + Shift/Space &nbsp;|&nbsp; [P2] WASD + Shift
            </div>
        </div>

        <!-- ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
<div id="screen-network" class="screen panel-glass">
    <h2>NETWORK SYSTEM</h2>
    
    <!-- åˆæœŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div id="net-menu-init" class="menu-grid">
        <button class="btn btn-net" onclick="Network.initHost()">ãƒ«ãƒ¼ãƒ ä½œæˆ (HOST)</button>
        <div class="divider">ã¾ãŸã¯</div>
        
        <!-- è¿½åŠ : ã‚«ãƒ¡ãƒ©æ˜ åƒè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="qr-reader"></div>

        <!-- å¤‰æ›´: IDå…¥åŠ›æ¬„ã¨ã‚«ãƒ¡ãƒ©ãƒœã‚¿ãƒ³ -->
        <div style="display:flex; gap:5px;">
            <input type="text" id="net-room-id" class="room-input" placeholder="HOST ID">
            <button class="btn btn-sub" onclick="Network.toggleScanner()" style="width:50px; padding:0;">ğŸ“·</button>
        </div>

        <button class="btn btn-net" onclick="Network.joinRoom()">ãƒ«ãƒ¼ãƒ å‚åŠ  (GUEST)</button>
        <button class="btn btn-back" onclick="Network.closeMenu()">æˆ»ã‚‹</button>
    </div>

    <!-- ãƒ›ã‚¹ãƒˆå¾…æ©Ÿç”»é¢ -->
    <div id="net-menu-host" class="menu-grid" style="display:none; text-align:center;">
        <p class="sys-msg">IDã‚’å…±æœ‰ã€ã¾ãŸã¯QRã‚’ã‚¹ã‚­ãƒ£ãƒ³</p>
        
        <!-- è¿½åŠ : QRã‚³ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="qrcode-display"></div>

        <div id="host-id-display" class="id-box">ç”Ÿæˆä¸­...</div>
        <div class="net-status">å¯¾æˆ¦ç›¸æ‰‹ã®æ¥ç¶šã‚’å¾…æ©Ÿä¸­...</div>
        <button class="btn btn-back" onclick="location.reload()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>

    <!-- æ¥ç¶šä¸­ç”»é¢ -->
    <div id="net-menu-connecting" class="menu-grid" style="display:none; text-align:center;">
        <div class="net-status" style="color:#00f3ff;">æ¥ç¶šã‚’ç¢ºç«‹ä¸­...</div>
    </div>
</div>

        <!-- ãƒ‘ãƒ‰ãƒ«å·¥æˆ¿ -->
        <div id="screen-editor" class="screen panel-glass">
            <h2>PADDLE FACTORY</h2>
            <div class="editor-layout">
                <div class="editor-container">
                    <div id="pixel-grid"></div>
                    <div id="color-palette"></div>
                </div>
                <div class="menu-grid editor-btns">
                    <button class="btn btn-gold" onclick="GameApp.applyCustomPaddle()">è£…å‚™ã—ã¦ã‚²ãƒ¼ãƒ ã¸</button>
                    <div class="btn-row">
                        <button class="btn btn-sub" onclick="GameApp.savePaddleWebP()">ç”»åƒä¿å­˜</button>
                        <button class="btn btn-sub" onclick="document.getElementById('paddle-webp-input').click()">ç”»åƒèª­è¾¼</button>
                    </div>
                    <div class="btn-row">
                        <button class="btn btn-sub" onclick="GameApp.savePaddleJSON()">ãƒ‡ãƒ¼ã‚¿ä¿å­˜</button>
                        <button class="btn btn-sub" onclick="document.getElementById('paddle-file-input').click()">ãƒ‡ãƒ¼ã‚¿èª­è¾¼</button>
                    </div>
                    <button class="btn btn-warn" onclick="GameApp.clearEditor()">å…¨æ¶ˆå»</button>
                    <button class="btn btn-back" onclick="GameApp.closeEditor()">æˆ»ã‚‹</button>
                </div>
            </div>
            <input type="file" id="paddle-file-input" accept=".json" style="display: none;">
            <input type="file" id="paddle-webp-input" accept="image/webp,image/png" style="display: none;">
        </div>

        <!-- è¨­å®šç”»é¢ -->
        <div id="screen-settings" class="screen panel-glass">
            <h2>SELECT MODULE</h2>
            <div class="shape-grid" id="shape-selector"></div>
            <button class="btn btn-back" onclick="GameApp.closeSettings()" style="margin-top:20px;">æˆ»ã‚‹</button>
        </div>

        <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
        <div id="screen-game" class="screen">
            <div class="game-wrapper panel-glass">
                <div class="hud">
                    <div id="hud-left" class="hud-item">STAGE 1</div>
                    <div id="hud-center" class="hud-item hud-vs" style="display:none;">VS MODE</div>
                    <div id="hud-right" class="hud-item">SCORE: 0</div>
                </div>
                
                <canvas id="game-canvas"></canvas>
                
                <button id="btn-mobile-charge" class="mobile-btn">ãƒãƒ£ãƒ¼ã‚¸</button>
                
                <div id="overlay" class="overlay">
                    <h2 id="overlay-title">GAME OVER</h2>
                    <div class="result-box" id="overlay-stats"></div>
                    
                    <div class="menu-grid" style="width: 280px;">
                        <!-- å†æˆ¦ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
                        <div id="rematch-msg"></div>
                        
                        <button id="btn-retry" class="btn" onclick="GameApp.retry()">ãƒªãƒˆãƒ©ã‚¤</button>
                        <button class="btn btn-net" onclick="GameApp.shareScore()">ã‚¹ã‚³ã‚¢å…±æœ‰ (X)</button>
                        <button class="btn btn-back" onclick="GameApp.toTitle()">ã‚¿ã‚¤ãƒˆãƒ«ã¸</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="audio.js"></script>
    <script src="core.js"></script>
    <script src="main.js"></script>
</body>
</html>
